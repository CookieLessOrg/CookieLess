name: Backend Deployment
on:
  push:
    paths:
      - 'backend/**'
      - '.github/workflows/backend.yml'
      - 'playbook.yml'
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Ansible
        uses: ansible/ansible-action@master
        with:
          requirements: ansible-core==2.12

      - name: Run Ansible Playbook
        uses: ansible/ansible-action@master
        with:
          playbook: playbook.yml
          inventory: |
            [production]
            ${{ secrets.SERVER_IP }}
          extra-vars: |
            MONGO_INITDB_ROOT_USERNAME: ${{ secrets.MONGO_INITDB_ROOT_USERNAME }}
            MONGO_INITDB_ROOT_PASSWORD: ${{ secrets.MONGO_INITDB_ROOT_PASSWORD }}